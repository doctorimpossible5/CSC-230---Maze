Microsoft (R) Macro Assembler Version 6.11		    03/06/19 22:18:38
nextval.asm						     Page 1 - 1


				;---------------------------------------------------------------------
				; Program:   nextval subroutine
				;
				; Function:  Find next mouse move in an array 15 by 30.
				;            We can move into a position if its contents is blank ( 20h ).
				;
				; Input:     Calling sequence is:
				;            x    pointer   si
				;            y    pointer   di
				;            dir  pointer   bx
				;            maze pointer   bp
				;
				; Output:    x,y,dir modified in caller's data segment
				;
				; Owner:     Dana A. Lasher, Ian Smart
				;
				; Date:      Update Reason
				; --------------------------
				; 11/06/2016 Original version
				; 03/05/2019 First Draft
				;
				;---------------------------------------
				         .model    small               ;64k code and 64k data
				         .8086                         ;only allow 8086 instructions
				         public    nextval             ;allow extrnal programs to call
				;---------------------------------------


				;---------------------------------------
 0000				         .data                         ;start the data segment
 0000 1E			a         db       30                  ;char to represent a new
 0001 20			empty     db       20h                 ;char to represent a empty tile
				;---------------------------------------


				;---------------------------------------
 0000				         .code                         ;start the code segment
				;---------------------------------------
				; Save any modified registers
				;---------------------------------------
 0000				nextval:                               ;
 0000  50			         push      ax                  ;Save the address of di
 0001  51			         push      cx                  ;Save the address of si
 0002  53			         push      bx                  ;Save the address of bx
 0003  55			         push      bp                  ;Save the address of the maze
 0004  52			         push      dx                  ;
				;---------------------------------------
				; Code to make 1 move in the maze
				;---------------------------------------
 0005  80 07 02			         add       byte ptr [bx],2     ;
 0008				increment:                             ;
 0008  8A 05			         mov       al,[di]             ;Load al with the y value
 000A  8A 0C			         mov       cl,[si]             ;Load cl with the x value
 000C  80 2F 01			         sub       byte ptr [bx],1     ;
 000F  80 3F 00			         cmp       byte ptr [bx],0     ;
 0012  75 03			         jne       check               ;
 0014  C6 07 04			         mov       byte ptr [bx],4     ;
 0017				check:                                 ;
 0017  80 3F 02			         cmp       byte ptr [bx],2     ;
 001A  72 12			         jb        right               ;
 001C  74 1A			         je        down                ;
 001E  80 3F 04			         cmp       byte ptr [bx],4     ;
 0021  72 10			         jb        left                ;
 0023  74 05			         je        upward              ;
 0025				above:                                 ;
 0025  C6 07 01			         mov       byte ptr [bx],1     ;
 0028  EB 04			         jmp       right               ;
 002A				upward:                                ;
 002A  2C 01			         sub       al,1                ;
 002C  EB 0C			         jmp       calculate           ;
 002E				right:                                 ;
 002E  80 C1 01			         add       cl,1                ;
 0031  EB 07			         jmp       calculate           ;
 0033				left:                                  ;
 0033  80 E9 01			         sub       cl,1                ;
 0036  EB 02			         jmp       calculate           ;
 0038				down:                                  ;
 0038  04 01			         add       al,1                ;
 003A				calculate:                             ;
 003A  8A F0			         mov       dh,al               ;
 003C  8A D1			         mov       dl,cl               ;
 003E  FE C8			         dec       al                  ;Decrement y
 0040  FE C9			         dec       cl                  ;Decrement x
 0042  F6 26 0000 R		         mul       [a]                 ;Multiply y by columns
 0046  03 C1			         add       ax,cx               ;Add x to calculate offset
 0048  03 E8			         add       bp,ax               ;
 004A  3E: 8A 4E 00		         mov       cl,ds:[bp]          ;
 004E  2B E8			         sub       bp,ax               ;
 0050  80 F9 20			         cmp       cl,20h              ;Check if empty
 0053  75 B3			         jne       increment           ;Not empty, try again
				;---------------------------------------
				; Restore registers and return
				;---------------------------------------
 0055				exit:
 0055  88 35			         mov       [di],dh             ;
 0057  88 14			         mov       [si],dl             ;
 0059  5A			         pop       dx                  ;
 005A  5D			         pop       bp                  ;Restore the address of the maze
 005B  5B			         pop       bx                  ;Restore the address of the direction
 005C  59			         pop       cx                  ;Restore the address of si
 005D  58			         pop       ax                  ;Restore the address of di
 005E  C3			         ret                           ;return
				;---------------------------------------
				         end
 
Microsoft (R) Macro Assembler Version 6.11		    03/06/19 22:18:38
nextval.asm						     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

DGROUP . . . . . . . . . . . . .	GROUP
_DATA  . . . . . . . . . . . . .	16 Bit	 0002	  Word	  Public  'DATA'	
_TEXT  . . . . . . . . . . . . .	16 Bit	 005F	  Word	  Public  'CODE'	


Symbols:

                N a m e                 Type     Value    Attr

@CodeSize  . . . . . . . . . . .	Number	 0000h	 
@DataSize  . . . . . . . . . . .	Number	 0000h	 
@Interface . . . . . . . . . . .	Number	 0000h	 
@Model . . . . . . . . . . . . .	Number	 0002h	 
@code  . . . . . . . . . . . . .	Text   	 _TEXT
@data  . . . . . . . . . . . . .	Text   	 DGROUP
@fardata?  . . . . . . . . . . .	Text   	 FAR_BSS
@fardata . . . . . . . . . . . .	Text   	 FAR_DATA
@stack . . . . . . . . . . . . .	Text   	 DGROUP
above  . . . . . . . . . . . . .	L Near	 0025	  _TEXT	
a  . . . . . . . . . . . . . . .	Byte	 0000	  _DATA	
calculate  . . . . . . . . . . .	L Near	 003A	  _TEXT	
check  . . . . . . . . . . . . .	L Near	 0017	  _TEXT	
down . . . . . . . . . . . . . .	L Near	 0038	  _TEXT	
empty  . . . . . . . . . . . . .	Byte	 0001	  _DATA	
exit . . . . . . . . . . . . . .	L Near	 0055	  _TEXT	
increment  . . . . . . . . . . .	L Near	 0008	  _TEXT	
left . . . . . . . . . . . . . .	L Near	 0033	  _TEXT	
nextval  . . . . . . . . . . . .	L Near	 0000	  _TEXT	Public
right  . . . . . . . . . . . . .	L Near	 002E	  _TEXT	
upward . . . . . . . . . . . . .	L Near	 002A	  _TEXT	

	   0 Warnings
	   0 Errors
