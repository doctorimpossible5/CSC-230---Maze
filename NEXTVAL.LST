Microsoft (R) Macro Assembler Version 6.11		    03/06/19 23:44:09
nextval.asm						     Page 1 - 1


				;---------------------------------------------------------------------
				; Program:   nextval subroutine
				;
				; Function:  Find next mouse move in an array 15 by 30.
				;            We can move into a position if its contents is blank ( 20h ).
				;
				; Input:     Calling sequence is:
				;            x    pointer   si
				;            y    pointer   di
				;            dir  pointer   bx
				;            maze pointer   bp
				;
				; Output:    x,y,dir modified in caller's data segment
				;
				; Owner:     Dana A. Lasher, Ian Smart Thomas Landsb
				;
				; Date:      Update Reason
				; --------------------------
				; 11/06/2016 Original version
				; 03/05/2019 First Draft
				;
				;---------------------------------------
				         .model    small               ;64k code and 64k data
				         .8086                         ;only allow 8086 instructions
				         public    nextval             ;allow extrnal programs to call
				;---------------------------------------


				;---------------------------------------
 0000				         .data                         ;start the data segment
 0000 1E			a         db       30                  ;char to represent a new
 0001 20			empty     db       20h                 ;char to represent a empty tile
				;---------------------------------------


				;---------------------------------------
 0000				         .code                         ;start the code segment
				;---------------------------------------
				; Save any modified registers
				;---------------------------------------
 0000				nextval:                               ;
 0000  50			         push      ax                  ;Save the address of di
 0001  51			         push      cx                  ;Save the address of si
 0002  53			         push      bx                  ;Save the address of bx
 0003  55			         push      bp                  ;Save the address of the maze
 0004  52			         push      dx                  ;Save the address of the dx
				;---------------------------------------
				; Start of the loop and increments the
				; direction
				;---------------------------------------
 0005  80 07 02			         add       byte ptr [bx],2     ;Add 2 to the address in the first pass
 0008				increment:                             ;Label for the begining of the loop
 0008  8A 05			         mov       al,[di]             ;Load al with the y value
 000A  8A 0C			         mov       cl,[si]             ;Load cl with the x value
 000C  80 2F 01			         sub       byte ptr [bx],1     ;Move to the next direction
 000F  80 3F 00			         cmp       byte ptr [bx],0     ;Check to see if the direction is out of bounds
 0012  75 03			         jne       check               ;If not continue
 0014  C6 07 04			         mov       byte ptr [bx],4     ;If it is out of bounds, reset it
				;---------------------------------------
				; Checks to see what the current direction
				; is and passes it to the correct label 
				;---------------------------------------
 0017				check:                                 ;
 0017  80 3F 02			         cmp       byte ptr [bx],2     ;Check if the direction is down
 001A  72 0C			         jb        right               ;Jump to right
 001C  74 18			         je        down                ;Jump to down
 001E  80 3F 04			         cmp       byte ptr [bx],4     ;Check if the direction is upward
 0021  72 0E			         jb        left                ;Jump to left
 0023  74 08			         je        upward              ;Jump to right
				;---------------------------------------
				; Resets the direction if the value is above 4
				;---------------------------------------
 0025				above:                                 ;Handles direction being out of bounds
 0025  C6 07 01			         mov       byte ptr [bx],1     ;Resets the direction
				;---------------------------------------
				; Set X and Y according to the direction
				;---------------------------------------
 0028				right:                                 ;
 0028  80 C1 01			         add       cl,1                ;Moves x up 1
 002B  EB 0B			         jmp       calculate           ;Jumps to calculation
 002D				upward:                                ;
 002D  2C 01			         sub       al,1                ;Moves y down 1
 002F  EB 07			         jmp       calculate           ;Jumps to calulation
 0031				left:                                  ;
 0031  80 E9 01			         sub       cl,1                ;Moves x down 1
 0034  EB 02			         jmp       calculate           ;Jumps to calculation
 0036				down:                                  ;
 0036  04 01			         add       al,1                ;Moves y up 1
				;---------------------------------------
				; Saves the x and y values in another register
				; so the current ones can be used to calculate the offset
				;---------------------------------------
 0038				calculate:                             ;
 0038  8A F0			         mov       dh,al               ;Saves y value
 003A  8A D1			         mov       dl,cl               ;Saves x value
				;---------------------------------------
				; Calculate the offset
				;---------------------------------------
 003C  FE C8			         dec       al                  ;Decrement y
 003E  FE C9			         dec       cl                  ;Decrement x
 0040  F6 26 0000 R		         mul       [a]                 ;Multiply y by columns
 0044  03 C1			         add       ax,cx               ;Add x to calculate offset
				;---------------------------------------
				; Checks to see if the space is empty.
				; If its not, it starts over.
				;---------------------------------------
 0046  03 E8			         add       bp,ax               ;Offsets bp by the offset
 0048  3E: 8A 4E 00		         mov       cl,ds:[bp]          ;Copies over the 
 004C  2B E8			         sub       bp,ax               ;Resets bp
 004E  80 F9 20			         cmp       cl,20h              ;Check if empty
 0051  75 B5			         jne       increment           ;Not empty, try again
				;---------------------------------------
				; Restore registers and return
				;---------------------------------------
 0053				exit:
 0053  88 35			         mov       [di],dh             ;Stores the new y value 
 0055  88 14			         mov       [si],dl             ;Stores the new x value
 0057  5A			         pop       dx                  ;Restore the address of dx
 0058  5D			         pop       bp                  ;Restore the address of the maze
 0059  5B			         pop       bx                  ;Restore the address of the direction
 005A  59			         pop       cx                  ;Restore the address of si
 005B  58			         pop       ax                  ;Restore the address of di
 005C  C3			         ret                           ;return
				;---------------------------------------
				         end
 
Microsoft (R) Macro Assembler Version 6.11		    03/06/19 23:44:09
nextval.asm						     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

DGROUP . . . . . . . . . . . . .	GROUP
_DATA  . . . . . . . . . . . . .	16 Bit	 0002	  Word	  Public  'DATA'	
_TEXT  . . . . . . . . . . . . .	16 Bit	 005D	  Word	  Public  'CODE'	


Symbols:

                N a m e                 Type     Value    Attr

@CodeSize  . . . . . . . . . . .	Number	 0000h	 
@DataSize  . . . . . . . . . . .	Number	 0000h	 
@Interface . . . . . . . . . . .	Number	 0000h	 
@Model . . . . . . . . . . . . .	Number	 0002h	 
@code  . . . . . . . . . . . . .	Text   	 _TEXT
@data  . . . . . . . . . . . . .	Text   	 DGROUP
@fardata?  . . . . . . . . . . .	Text   	 FAR_BSS
@fardata . . . . . . . . . . . .	Text   	 FAR_DATA
@stack . . . . . . . . . . . . .	Text   	 DGROUP
above  . . . . . . . . . . . . .	L Near	 0025	  _TEXT	
a  . . . . . . . . . . . . . . .	Byte	 0000	  _DATA	
calculate  . . . . . . . . . . .	L Near	 0038	  _TEXT	
check  . . . . . . . . . . . . .	L Near	 0017	  _TEXT	
down . . . . . . . . . . . . . .	L Near	 0036	  _TEXT	
empty  . . . . . . . . . . . . .	Byte	 0001	  _DATA	
exit . . . . . . . . . . . . . .	L Near	 0053	  _TEXT	
increment  . . . . . . . . . . .	L Near	 0008	  _TEXT	
left . . . . . . . . . . . . . .	L Near	 0031	  _TEXT	
nextval  . . . . . . . . . . . .	L Near	 0000	  _TEXT	Public
right  . . . . . . . . . . . . .	L Near	 0028	  _TEXT	
upward . . . . . . . . . . . . .	L Near	 002D	  _TEXT	

	   0 Warnings
	   0 Errors
